<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0"
    />
    <meta name="description" content="–ü–∞–Ω–µ–ª—å –∂–∏—Ç–µ–ª—è ‚Äî Core City" />
    <title>–ñ–∏—Ç–µ–ª—å ‚Äî Core City</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/citizen.css" />
    <!-- Leaflet CSS –¥–ª—è –∫–∞—Ä—Ç—ã –≤ –º–æ–¥–∞–ª–∫–µ -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
  </head>
  <body>
    <!-- Navbar (–∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ auth.js) -->
    <nav class="navbar">
      <div class="container">
        <div class="navbar-inner">
          <div class="logo">üèôÔ∏è Core City</div>
          <div class="nav-links">
            <span id="nav-username"></span>
            <button onclick="logout()" class="btn-logout">–í—ã–π—Ç–∏</button>
          </div>
        </div>
      </div>
    </nav>

    <main class="container" style="margin-top: 84px; margin-bottom: 40px">
      <!-- –°–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ -->
      <section id="create-request" class="card" style="margin-bottom: 32px">
        <h2 style="margin-bottom: 24px">üìã –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</h2>

        <form id="requestForm">
          <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
          <div class="form-group">
            <label for="category"
              >–ö–∞—Ç–µ–≥–æ—Ä–∏—è <span class="required">*</span></label
            >
            <select id="category" class="input" required>
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
              <option value="lighting">üí° –û—Å–≤–µ—â–µ–Ω–∏–µ</option>
              <option value="garbage">üóëÔ∏è –ú—É—Å–æ—Ä</option>
              <option value="pothole">üï≥Ô∏è –î–æ—Ä–æ–≥–∏ (—è–º—ã)</option>
              <option value="other">üîß –î—Ä—É–≥–æ–µ</option>
            </select>
          </div>

          <!-- –û–ø–∏—Å–∞–Ω–∏–µ + —Å—á—ë—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ -->
          <div class="form-group">
            <label for="description"
              >–û–ø–∏—Å–∞–Ω–∏–µ <span class="required">*</span></label
            >
            <textarea
              id="description"
              class="input"
              rows="4"
              minlength="10"
              maxlength="500"
              placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ..."
              required
            ></textarea>
            <div class="form-hint">
              <span id="char-counter">0</span>/500 —Å–∏–º–≤–æ–ª–æ–≤ (–º–∏–Ω. 10)
            </div>
          </div>

          <!-- –§–æ—Ç–æ + –ø—Ä–µ–≤—å—é -->
          <div class="form-group">
            <label for="photo"
              >–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è <span class="required">*</span></label
            >
            <div class="upload-area" id="uploadArea">
              <div class="upload-placeholder">
                <span class="upload-icon">üì∏</span>
                <p>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ</p>
                <span class="upload-hint">JPEG, PNG, –¥–æ 5MB</span>
              </div>
              <input
                type="file"
                id="photo"
                accept="image/jpeg,image/png"
                style="display: none"
              />
            </div>
            <div
              id="photoPreview"
              class="photo-preview"
              style="display: none"
            ></div>
          </div>

          <!-- –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ -->
          <div class="form-group">
            <label>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ <span class="required">*</span></label>
            <div style="display: flex; gap: 8px; margin-bottom: 8px">
              <button
                type="button"
                id="detectLocationBtn"
                class="btn btn-secondary"
              >
                üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å
              </button>
              <input
                type="text"
                id="address"
                class="input"
                placeholder="–ê–¥—Ä–µ—Å"
                required
              />
            </div>
            <input type="hidden" id="lat" />
            <input type="hidden" id="lng" />
          </div>

          <button type="submit" class="btn btn-primary btn-block">
            üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
          </button>
        </form>
      </section>

      <!-- –°–µ–∫—Ü–∏—è "–ú–æ–∏ –∑–∞—è–≤–∫–∏" -->
      <section id="my-requests">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
          "
        >
          <h2 style="margin-bottom: 0">üìå –ú–æ–∏ –∑–∞—è–≤–∫–∏</h2>

          <!-- –§–∏–ª—å—Ç—Ä-—Ç–∞–±—ã -->
          <div class="filter-tabs">
            <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
            <button class="filter-btn" data-filter="pending">–û–∂–∏–¥–∞–µ—Ç</button>
            <button class="filter-btn" data-filter="in_progress">
              –í —Ä–∞–±–æ—Ç–µ
            </button>
            <button class="filter-btn" data-filter="completed">
              –í—ã–ø–æ–ª–Ω–µ–Ω–æ
            </button>
          </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
        <div id="requests-list" class="requests-grid">
          <!-- –ë—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
          <div
            class="text-center"
            style="grid-column: 1/-1; padding: 48px; color: var(--gray-500)"
          >
            –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...
          </div>
        </div>
      </section>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –∑–∞—è–≤–∫–∏ -->
    <div id="requestModal" class="modal-overlay" style="display: none">
      <div class="modal">
        <button class="modal-close" onclick="closeModal()">√ó</button>
        <div id="modalContent"></div>
      </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="js/auth.js"></script>
    <script src="js/citizen.js"></script>
    <script>
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.addEventListener("DOMContentLoaded", function () {
        if (!requireAuth()) return;

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –Ω–∞–≤–±–∞—Ä–µ
        const user = getCurrentUser();
        if (user) {
          document.getElementById("nav-username").textContent =
            user.full_name || user.email;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∂–∏—Ç–µ–ª—è
        initCitizenPage();
      });
    </script>
  </body>
</html>
